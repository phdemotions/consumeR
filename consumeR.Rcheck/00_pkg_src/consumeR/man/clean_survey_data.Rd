% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_cleaning.R
\name{clean_survey_data}
\alias{clean_survey_data}
\title{Clean and Prepare Survey Data with Publication-Ready Exclusion Reporting}
\usage{
clean_survey_data(
  data,
  pretest_var = NULL,
  pretest_values = c(TRUE, 1, "pretest", "pre-test", "test"),
  date_var = NULL,
  pretest_before_date = NULL,
  inclusion_criteria = NULL,
  attention_checks = NULL,
  attention_check_rule = "all",
  additional_exclusions = NULL,
  additional_exclusion_reason = "Additional exclusions",
  rename_vars = NULL,
  recode_vars = NULL,
  id_var = NULL,
  verbose = TRUE
)
}
\arguments{
\item{data}{Data frame with your raw survey data (usually from Qualtrics, MTurk, etc.)}

\item{pretest_var}{**Column name** that marks pre-test cases (or NULL if no pre-tests).

  **What this is:** The name of the column in your data that identifies pre-test responses.
  Pre-tests are responses you collected BEFORE your main study (pilot testing, your own
  test responses, etc.). These shouldn't be counted in your sample size.

  **Real examples:**
  - Qualtrics often creates: `"Status"` (values: "Survey Preview" = pre-test)
  - Or you might have: `"is_pilot"`, `"test_response"`, `"preview"`
  - MTurk: You might mark your own tests with a specific worker ID

  **How to find it:**
  Look at your column names: `names(raw_data)` or `colnames(raw_data)`

  **If you don't have pre-tests:** Just use `pretest_var = NULL` (the default)}

\item{pretest_values}{**Values** in the pretest_var column that indicate it's a pre-test.

  **What this is:** What values in that column mean "this is a pre-test"?

  **Real examples:**
  - If using Qualtrics Status: `pretest_values = "Survey Preview"`
  - If you have a TRUE/FALSE column: `pretest_values = c(TRUE, 1, "yes")`
  - If you marked tests with special ID: `pretest_values = "RESEARCHER_TEST"`

  **Default:** c(TRUE, 1, "pretest", "pre-test", "test") - catches common cases}

\item{date_var}{**Column name** containing response dates/timestamps (or NULL).

  **What this is:** The column that shows when each response was collected.
  Use this if you want to exclude responses collected before a certain date.

  **Real examples:**
  - Qualtrics: `"StartDate"`, `"EndDate"`, or `"RecordedDate"`
  - MTurk: `"SubmitTime"` or `"AcceptTime"`
  - Your own: Whatever timestamp column you have

  **How to find it:**
  Look for date/time columns: `names(raw_data)` - often contains "Date" or "Time"

  **Note:** Works with most date formats (automatically converted)}

\item{pretest_before_date}{**Cutoff date** - exclude responses collected before this date (or NULL).

  **What this is:** Any responses collected BEFORE this date will be treated as pre-tests.
  Useful when you did pilot testing before your main data collection.

  **Real examples:**
  ```r
  # If you started real data collection on March 15, 2024:
  pretest_before_date = "2024-03-15"

  # Or use a Date object:
  pretest_before_date = as.Date("2024-03-15")

  # With specific time (if you have timestamps):
  pretest_before_date = as.POSIXct("2024-03-15 09:00:00")
  ```

  **Date formats accepted:**
  - "YYYY-MM-DD" (recommended): `"2024-03-15"`
  - Date objects: `as.Date("2024-03-15")`
  - POSIXct timestamps: `as.POSIXct("2024-03-15 09:00:00")`

  **How to use with `date_var`:**
  Both must be provided together. The function will exclude any rows where
  `date_var < pretest_before_date`

  **Can combine with `pretest_var`:** If you provide both date-based and column-based
  pre-test criteria, responses matching EITHER will be removed}

\item{inclusion_criteria}{**Named list** of requirements participants must meet.

  **What this is:** Rules that determine if someone should be INCLUDED in your analysis.
  Create a list where each element is a TRUE/FALSE check.

  **Structure:** `list(criterion_name = TRUE/FALSE for each row)`

  **Real examples:**

  ```r
  # Example 1: Basic Qualtrics survey
  inclusion_criteria = list(
    completed = raw_data$Finished == 1,              # Qualtrics completion flag
    adult = raw_data$age >= 18,                      # Age requirement
    consented = raw_data$consent == "I agree"        # Gave consent
  )

  # Example 2: MTurk study
  inclusion_criteria = list(
    completed = raw_data$status == "Submitted",
    approval_rate = raw_data$approval >= 95,         # MTurk 95%+ approval
    min_hits = raw_data$total_hits >= 100,           # At least 100 HITs
    us_only = raw_data$location == "US"
  )

  # Example 3: Just want people who finished
  inclusion_criteria = list(
    completed = raw_data$Finished == 1
  )
  ```

  **How to figure out column names:**
  - Run: `names(raw_data)` to see all columns
  - Look for: "Finished", "Status", "Progress", etc.
  - Check what values mean completion: `table(raw_data$Finished)`}

\item{attention_checks}{**Named list** of attention check questions and correct answers.

  **What this is:** Questions where you told participants "Select [specific answer]".
  These catch people who aren't paying attention.

  **Structure:** Each attention check needs:
  - `var`: The column name for that question
  - `correct`: The correct answer

  **Real examples:**

  ```r
  # Example 1: Likert scale attention checks (1-7 scale)
  attention_checks = list(
    ac1 = list(var = "Q5_1", correct = 7),           # "Select Strongly Agree (7)"
    ac2 = list(var = "Q12_1", correct = 1)           # "Select Strongly Disagree (1)"
  )

  # Example 2: Text-based attention checks
  attention_checks = list(
    ac1 = list(var = "attention_1", correct = "blue"),       # "Select 'blue'"
    ac2 = list(var = "attention_2", correct = "strongly agree")  # Exact text match
  )

  # Example 3: Multiple choice (numeric coding)
  attention_checks = list(
    ac1 = list(var = "AC_Q3", correct = 4)           # Option 4 was correct
  )
  ```

  **How to find column names:**
  - In Qualtrics: Questions are often "Q1", "Q2", "Q3", etc.
  - Look at: `names(raw_data)` to find your attention check columns
  - Check what values people selected: `table(raw_data$Q5_1)`

  **What's the correct answer?**
  - Look at your survey - what did you tell people to select?
  - Check your data: `unique(raw_data$Q5_1)` to see possible values}

\item{attention_check_rule}{**How many** attention checks must someone pass?

  **Options:**
  - `"all"` (default and recommended): Must pass EVERY attention check
  - `"majority"`: Must pass more than half (e.g., 2 out of 3)
  - A number: Must pass at least this many (e.g., `2` means pass at least 2)

  **Examples:**
  - If you have 3 attention checks and want to be strict: `"all"`
  - If you want to be lenient (allow 1 failure): `2` (must pass 2 out of 3)
  - If you have many checks and want majority: `"majority"`

  **Recommendation:** Use `"all"` - it's most common in publications}

\item{additional_exclusions}{**TRUE/FALSE vector** for any other exclusions.

  **What this is:** Any other reason to exclude someone (duplicates, bots, etc.)

  **Real examples:**

  ```r
  # Exclude duplicate IP addresses
  additional_exclusions = duplicated(raw_data$IPAddress)

  # Exclude people who finished too fast (< 2 minutes)
  additional_exclusions = raw_data$Duration_seconds < 120

  # Exclude based on multiple criteria
  additional_exclusions = duplicated(raw_data$IPAddress) |
                         raw_data$Duration_seconds < 120
  ```}

\item{additional_exclusion_reason}{**Text description** of those exclusions.

  **Examples:**
  - `"Duplicate IP addresses"`
  - `"Completed survey too quickly (< 2 minutes)"`
  - `"Failed quality checks"`}

\item{rename_vars}{**Named list** for renaming variables (or NULL).

  **What this is:** Renames columns from Qualtrics' random names to meaningful names.

  **Real examples:**
  ```r
  # Qualtrics often names questions Q1, Q2, Q3...
  # Give them meaningful names:
  rename_vars = list(
    brand_attitude = "Q1",           # Rename Q1 to brand_attitude
    purchase_intent = "Q2",          # Rename Q2 to purchase_intent
    age = "Q17",                     # Rename Q17 to age
    condition = "FL_16_DO"           # Rename Qualtrics flow to condition
  )
  ```

  **Structure:** `list(new_name = "old_name")`
  - Left side = what you WANT to call it
  - Right side = what Qualtrics CURRENTLY calls it

  **How to find old names:** Run `names(raw_data)` to see current column names}

\item{recode_vars}{**Named list** for recoding variable values (or NULL).

  **What this is:** Changes coded values to meaningful labels.
  Useful for converting numeric codes to text labels or fixing typos.

  **Real examples:**
  ```r
  # Example 1: Recode numeric condition codes to text labels
  recode_vars = list(
    condition = c("1" = "control", "2" = "treatment_A", "3" = "treatment_B")
  )

  # Example 2: Fix inconsistent text responses
  recode_vars = list(
    gender = c("m" = "Male", "M" = "Male", "male" = "Male",
               "f" = "Female", "F" = "Female", "female" = "Female")
  )

  # Example 3: Recode multiple variables
  recode_vars = list(
    condition = c("1" = "control", "2" = "treatment"),
    consent = c("1" = "yes", "2" = "no"),
    likert_scale = c("1" = "Strongly Disagree", "2" = "Disagree",
                     "3" = "Neutral", "4" = "Agree", "5" = "Strongly Agree")
  )
  ```

  **Structure:** `list(var_name = c("old" = "new", "old2" = "new2"))`

  **Note:** Use the NEW names if you're also using `rename_vars`}

\item{id_var}{**Column name** with participant IDs (for tracking).

  **Common names:**
  - Qualtrics: `"ResponseId"` or `"ResponseID"`
  - MTurk: `"WorkerId"` or `"worker_id"`
  - Prolific: `"PROLIFIC_PID"`
  - Your own: Whatever you named it

  **To find it:** Run `names(raw_data)` and look for ID column}

\item{verbose}{Show detailed progress messages? (TRUE = yes, see what's happening)}
}
\value{
A list with:
  - `clean_data`: Your cleaned dataset (use this for analysis!)
  - `n_initial`: Initial sample size (AFTER removing pre-tests)
  - `n_final`: Final sample size
  - `exclusion_summary`: Table of exclusions (for your manuscript)
  - `publication_text`: Copy-paste into your Methods section
  - `flags`: Which participants were excluded for which reasons
  - `renamed_vars`: Which variables were renamed (old -> new)
  - `recoded_vars`: Which variables had values recoded
}
\description{
**This is STEP 1 in your research workflow.** Cleans survey data by systematically
excluding cases and creates publication-ready participant flow documentation.

**What this function does:**
- Removes pre-test/pilot data (if applicable)
- Excludes participants who don't meet your inclusion criteria
- Removes participants who failed attention checks
- Tracks every exclusion with detailed reasons
- Generates publication text for your Methods section
}
\section{For Novice Researchers}{


**Confused about what to put in each parameter?** Here's the easiest approach:

1. **First, look at your column names:**
   ```r
   names(raw_data)  # Shows all column names
   ```

2. **Start simple - just exclude incomplete responses:**
   ```r
   result <- clean_survey_data(
     data = raw_data,
     inclusion_criteria = list(
       completed = raw_data$Finished == 1  # Qualtrics completion column
     )
   )
   ```

3. **Add attention checks (if you have them):**
   ```r
   # First, figure out which columns are your attention checks
   names(raw_data)  # Look for your attention check question numbers

   result <- clean_survey_data(
     data = raw_data,
     inclusion_criteria = list(
       completed = raw_data$Finished == 1
     ),
     attention_checks = list(
       # Replace Q5 with your actual question number
       ac1 = list(var = "Q5", correct = 7)  # Whatever answer was correct
     )
   )
   ```

4. **Add more criteria as needed:**
   ```r
   result <- clean_survey_data(
     data = raw_data,
     inclusion_criteria = list(
       completed = raw_data$Finished == 1,
       adult = raw_data$age >= 18,
       consented = raw_data$consent == "I agree"
     ),
     attention_checks = list(
       ac1 = list(var = "Q5", correct = 7),
       ac2 = list(var = "Q12", correct = "agree")
     ),
     id_var = "ResponseId"
   )
   ```

**Still confused?** Common issues:
- **Don't know column names?** Run: `names(raw_data)` or `colnames(raw_data)`
- **Don't know what values mean completion?** Run: `table(raw_data$Finished)`
- **Don't have attention checks?** Just leave out the `attention_checks` parameter
- **Don't have pre-tests?** Leave out `pretest_var` (it's NULL by default)
- **Want to remove pre-tests by date instead?** Use `date_var` + `pretest_before_date`
  (e.g., if you started real data collection on March 1, exclude anything before that date)
}

\examples{
\dontrun{
# ========================================================================
# EXAMPLE 1: Minimal - Just exclude incomplete responses
# ========================================================================

result <- clean_survey_data(
  data = raw_data,
  inclusion_criteria = list(
    completed = raw_data$Finished == 1
  )
)

# ========================================================================
# EXAMPLE 2: Typical Qualtrics study with attention checks
# ========================================================================

result <- clean_survey_data(
  data = raw_data,

  # Qualtrics marks preview responses in the Status column
  pretest_var = "Status",
  pretest_values = "Survey Preview",

  # Requirements to be included
  inclusion_criteria = list(
    completed = raw_data$Finished == 1,        # Completed survey
    adult = raw_data$age >= 18,                 # 18 or older
    consented = raw_data$consent == "I agree"   # Gave consent
  ),

  # Attention checks (replace Q5, Q12 with your question numbers)
  attention_checks = list(
    ac1 = list(var = "Q5", correct = 7),       # Told them to select 7
    ac2 = list(var = "Q12", correct = 1)       # Told them to select 1
  ),
  attention_check_rule = "all",  # Must pass both

  id_var = "ResponseId"  # Qualtrics ID column
)

# ========================================================================
# EXAMPLE 2B: Date-based pre-test removal
# ========================================================================

# If you ran pre-tests in February and started real data collection March 1
result <- clean_survey_data(
  data = raw_data,

  # Remove anything collected before March 1, 2024
  date_var = "StartDate",                       # Qualtrics start date column
  pretest_before_date = "2024-03-01",           # Cutoff date

  # Rest of your criteria
  inclusion_criteria = list(
    completed = raw_data$Finished == 1,
    adult = raw_data$age >= 18
  ),

  attention_checks = list(
    ac1 = list(var = "Q5", correct = 7)
  ),

  id_var = "ResponseId"
)

# ========================================================================
# EXAMPLE 2C: Combine column-based AND date-based pre-test removal
# ========================================================================

# Remove BOTH "Survey Preview" responses AND anything before March 1
result <- clean_survey_data(
  data = raw_data,

  # Column-based: Qualtrics preview responses
  pretest_var = "Status",
  pretest_values = "Survey Preview",

  # Date-based: Anything before March 1
  date_var = "StartDate",
  pretest_before_date = "2024-03-01",

  # Other criteria...
  inclusion_criteria = list(
    completed = raw_data$Finished == 1
  ),

  id_var = "ResponseId"
)

# Get your cleaned data
clean_df <- result$clean_data

# Copy this into your Methods section
cat(result$publication_text$concise)

# ========================================================================
# EXAMPLE 3: MTurk study
# ========================================================================

result <- clean_survey_data(
  data = raw_data,

  # Mark your own test responses
  pretest_var = "WorkerId",
  pretest_values = "YOUR_WORKER_ID_HERE",

  # MTurk quality criteria
  inclusion_criteria = list(
    submitted = raw_data$AssignmentStatus == "Submitted",
    approval = raw_data$ApprovalRate >= 95,
    min_hits = raw_data$TotalHITS >= 100,
    us_location = raw_data$CountryOfResidence == "US"
  ),

  # Your attention checks
  attention_checks = list(
    ac1 = list(var = "attention_1", correct = "blue"),
    ac2 = list(var = "attention_2", correct = 4)
  ),

  # Also exclude duplicates and speeders
  additional_exclusions = duplicated(raw_data$WorkerId) |
                         raw_data$duration_sec < 120,
  additional_exclusion_reason = "Duplicate worker IDs or completed too quickly",

  id_var = "WorkerId"
)

# ========================================================================
# EXAMPLE 4: No attention checks, just basic cleaning
# ========================================================================

result <- clean_survey_data(
  data = raw_data,
  inclusion_criteria = list(
    completed = raw_data$Finished == 1,
    consented = raw_data$consent_given == TRUE
  )
)
# That's it! No attention checks needed.

# ========================================================================
# EXAMPLE 5: Rename variables and recode values (VERY USEFUL!)
# ========================================================================

# First, check what Qualtrics named your columns
names(raw_data)
# [1] "ResponseId" "Q1" "Q2" "Q3" "Q17" "FL_16_DO" "Finished" ...

result <- clean_survey_data(
  data = raw_data,

  # Rename Qualtrics' random names to meaningful names
  rename_vars = list(
    brand_attitude = "Q1",          # Q1 -> brand_attitude
    purchase_intent = "Q2",         # Q2 -> purchase_intent
    satisfaction = "Q3",            # Q3 -> satisfaction
    age = "Q17",                    # Q17 -> age
    condition = "FL_16_DO"          # Flow field -> condition
  ),

  # Recode numeric codes to meaningful labels
  # IMPORTANT: Use the NEW names (after renaming)
  recode_vars = list(
    condition = c("1" = "control", "2" = "treatment_A", "3" = "treatment_B"),
    age = c("1" = "18-24", "2" = "25-34", "3" = "35-44", "4" = "45-54", "5" = "55+")
  ),

  # Now use the NEW names in your inclusion criteria
  inclusion_criteria = list(
    completed = raw_data$Finished == 1
  ),

  id_var = "ResponseId"
)

# Your clean data now has meaningful variable names and labels!
names(result$clean_data)
# [1] "ResponseId" "brand_attitude" "purchase_intent" "satisfaction" "age" "condition" ...

table(result$clean_data$condition)
# control  treatment_A  treatment_B
#     150          145          143

}

}
