% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/composite_scoring.R
\name{score_composite}
\alias{score_composite}
\title{Score Composite Scale with Metadata}
\usage{
score_composite(
  df,
  items,
  reverse_items = NULL,
  reverse_min = 1,
  reverse_max = 7,
  method = c("mean", "sum"),
  na_rule = c("preserve", "threshold"),
  threshold = NULL,
  name = NULL
)
}
\arguments{
\item{df}{Data frame containing items}

\item{items}{Character vector of item column names}

\item{reverse_items}{Character vector of items to reverse score (optional)}

\item{reverse_min}{Minimum value for reverse scoring (default 1)}

\item{reverse_max}{Maximum value for reverse scoring (default 7)}

\item{method}{Character. Composite method: "mean" (default) or "sum"}

\item{na_rule}{Character. How to handle missing values:
- "preserve" (default): Preserve NA (na.rm = FALSE)
- "threshold": Require minimum number of non-missing items}

\item{threshold}{Integer. If na_rule = "threshold", minimum non-missing items required.
If NULL, defaults to ceiling(length(items) * 0.5) (i.e., at least 50%)}

\item{name}{Character. Optional name for the composite (for metadata)}
}
\value{
A list with class "composite_score" containing:
\itemize{
  \item \code{value}: Numeric vector of composite scores
  \item \code{meta}: List with metadata:
    \itemize{
      \item \code{name}: Composite name (if provided)
      \item \code{items}: Character vector of items used
      \item \code{reverse_items}: Character vector of reversed items (or NULL)
      \item \code{k}: Number of items
      \item \code{method}: Composite method ("mean" or "sum")
      \item \code{na_rule}: NA handling rule used
      \item \code{threshold}: Threshold used (or NULL)
      \item \code{n_missing}: Integer vector showing count of missing items per row
      \item \code{below_threshold}: Logical vector indicating which rows didn't meet threshold
    }
}
}
\description{
Calculates composite scores from multiple items with optional reverse scoring
and flexible NA handling. Returns a structured object with scores and metadata.
}
\details{
**NA handling rules:**
- "preserve": Standard behavior, NA propagates (if any item is NA, composite is NA)
- "threshold": Calculate composite if at least `threshold` items are non-missing

**Default threshold:** 50% of items (rounded up)
- 3 items → need 2 non-missing
- 5 items → need 3 non-missing
- 10 items → need 5 non-missing
}
\examples{
# Basic composite (mean)
df <- data.frame(
  q1 = c(7, 6, 5, NA),
  q2 = c(6, 7, 4, 5),
  q3 = c(7, 6, 5, 6)
)
result <- score_composite(df, items = c("q1", "q2", "q3"))
result$value  # c(6.67, 6.33, 4.67, NA)
result$meta$k  # 3 items

# With reverse scoring
df2 <- data.frame(
  happy1 = c(7, 6, 5),   # Positive item
  sad2 = c(2, 3, 4),     # Negative item (needs reversing)
  happy3 = c(7, 6, 5)    # Positive item
)
result <- score_composite(
  df2,
  items = c("happy1", "sad2", "happy3"),
  reverse_items = "sad2"
)
result$value  # Sad2 reversed: (7,6,5) + (6,5,4) + (7,6,5) / 3

# Threshold rule (allow some missing)
df3 <- data.frame(
  q1 = c(7, NA, 5, NA, 7),
  q2 = c(6, 7, NA, NA, 6),
  q3 = c(7, 6, 5, NA, 7)
)
result <- score_composite(
  df3,
  items = c("q1", "q2", "q3"),
  na_rule = "threshold",
  threshold = 2  # Need at least 2 of 3 items
)
result$value  # Rows with 2+ items get score, row 4 (all NA) gets NA
result$meta$below_threshold  # Which rows didn't meet threshold

# Sum instead of mean
result <- score_composite(df, items = c("q1", "q2", "q3"), method = "sum")

}
